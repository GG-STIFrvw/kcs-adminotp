<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KCS Auto Service - System Documentation</title>
    <style>
        body { font-family: Arial, Helvetica, sans-serif; color: #222; line-height: 1.5; }
        .container { max-width: 900px; margin: 0 auto; padding: 24px; }
        h1, h2, h3 { color: #111; }
        h1 { font-size: 28px; margin-bottom: 8px; }
        h2 { font-size: 22px; margin-top: 28px; border-bottom: 2px solid #e5e5e5; padding-bottom: 6px; }
        h3 { font-size: 18px; margin-top: 18px; }
        p { margin: 10px 0; }
        ul { margin: 8px 0 16px 22px; }
        code, .code { font-family: Consolas, "Courier New", monospace; background: #f6f8fa; padding: 2px 4px; border-radius: 4px; }
        .kbd { border: 1px solid #bbb; border-bottom-width: 2px; background: #f9f9f9; border-radius: 3px; padding: 1px 4px; font-family: Consolas, "Courier New", monospace; }
        .note { background: #fff7e6; border-left: 4px solid #f0ad4e; padding: 10px 12px; border-radius: 4px; }
        .success { background: #eef9f0; border-left: 4px solid #28a745; padding: 10px 12px; border-radius: 4px; }
        .danger { background: #fdeeee; border-left: 4px solid #dc3545; padding: 10px 12px; border-radius: 4px; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0 16px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background: #f3f3f3; text-align: left; }
        .small { color: #666; font-size: 12px; }
        .toc a { text-decoration: none; color: #0b69c7; }
    </style>
</head>
<body>
<div class="container">
    <h1>KCS Auto Service - System Documentation</h1>
    <p class="small">Version: 1.0 • Date: <script>document.write(new Date().toISOString().slice(0,10))</script></p>

    <h2>Table of Contents</h2>
    <ol class="toc">
        <li><a href="#overview">Overview</a></li>
        <li><a href="#architecture">Architecture</a></li>
        <li><a href="#workflows">Core Workflows</a></li>
        <li><a href="#data-model">Data Model</a></li>
        <li><a href="#setup">Setup & Configuration</a></li>
        <li><a href="#security">Security & Compliance</a></li>
        <li><a href="#ops">Operations & Maintenance</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
        <li><a href="#appendix">Appendix (Files & Endpoints)</a></li>
    </ol>

    <h2 id="overview">1. Overview</h2>
    <p>This document describes the KCS Auto Service web system: its purpose, architecture, data model, workflows, setup, and operational practices. It is intended for administrators, developers, and operators. This HTML can be opened in Microsoft Word and saved as a .docx.</p>
    <ul>
        <li><strong>Purpose</strong>: Manage bookings, bays, job orders, quotations, inventory, and billing.</li>
        <li><strong>Roles</strong>: Customer, Staff, Inventory Manager, Admin.</li>
        <li><strong>Stack</strong>: PHP (PDO), MySQL, Tailwind/CSS, Flatpickr, Brevo (Sendinblue) for email.</li>
    </ul>

    <h2 id="architecture">2. Architecture</h2>
    <h3>2.1 Components</h3>
    <ul>
        <li><strong>Frontend</strong>: PHP-rendered pages with Tailwind CDN and custom CSS.</li>
        <li><strong>Backend</strong>: Procedural PHP endpoints using PDO for database access.</li>
        <li><strong>Email</strong>: Brevo Transactional Email API (verification, OTP, reset).</li>
        <li><strong>Storage</strong>: MySQL database, file uploads for receipts, images, and profile pictures.</li>
    </ul>
    <h3>2.2 High-Level Diagram</h3>
    <p class="note">For a printable diagram, replace this placeholder with your own image if needed.</p>
    <ul>
        <li>Browser ⇄ PHP App ⇄ MySQL</li>
        <li>PHP App ⇄ Brevo Email API</li>
        <li>PHP App ⇄ File Storage (uploads/, profile_pics/)</li>
    </ul>

    <h2 id="workflows">3. Core Workflows</h2>
    <h3>3.1 Authentication & Verification</h3>
    <ol>
        <li>User registers → Brevo verification email → <span class="code">verify.php?token=...</span>.</li>
        <li>Login checks email_verified and status; privileged roles require OTP via email.</li>
        <li>Password reset: <span class="code">forgot_password.php</span> → <span class="code">reset_password.php</span>.</li>
    </ol>
    <h3>3.2 Booking → Job Order → Quotation → Payment</h3>
    <ol>
        <li><strong>Booking</strong>: Customer books in <span class="code">book.php</span>; date picker blocks <span class="code">unavailable_dates</span>.</li>
        <li><strong>Confirmation</strong>: Staff confirms in <span class="code">manage.php</span>, assigns bay and mechanic.</li>
        <li><strong>Job Order</strong>: Staff creates in <span class="code">JOG.php</span>; appointment becomes in_progress.</li>
        <li><strong>Quotation</strong>: Staff prepares in <span class="code">QM.php</span> with extra services and products.</li>
        <li><strong>Customer Decision</strong>: Customer accepts/declines in <span class="code">view.php</span>.</li>
        <li><strong>Payment</strong>: Staff cash in <span class="code">Billing.php</span> or customer GCash in <span class="code">Billing_Cust.php</span>.</li>
    </ol>

    <h2 id="data-model">4. Data Model</h2>
    <p>Primary tables (see <span class="code">auto_service_dbgg.sql</span> for full DDL):</p>
    <table>
        <thead>
        <tr><th>Table</th><th>Description</th></tr>
        </thead>
        <tbody>
        <tr><td>users</td><td>Accounts, roles, email verification, profile picture</td></tr>
        <tr><td>vehicles</td><td>Customer vehicles linked to users</td></tr>
        <tr><td>services</td><td>Catalog of services with cost and status</td></tr>
        <tr><td>appointments</td><td>Booking records, status, schedule, bay, mechanic</td></tr>
        <tr><td>unavailable_dates</td><td>Calendar dates blocked for booking</td></tr>
        <tr><td>bays</td><td>Work bays and availability</td></tr>
        <tr><td>job_orders</td><td>Mechanic diagnosis, status, optional image</td></tr>
        <tr><td>quotations</td><td>Price proposals for job orders; accepted/declined/paid</td></tr>
        <tr><td>quotation_products</td><td>Line items for parts used in quotation</td></tr>
        <tr><td>inventory</td><td>Stock items, price, quantity</td></tr>
        <tr><td>payments</td><td>Cash/GCash payments, status, receipts</td></tr>
        <tr><td>logs</td><td>Operational logs (e.g., login attempts)</td></tr>
        <tr><td>password_resets</td><td>Tokens and expiry for resets</td></tr>
        </tbody>
    </table>

    <h2 id="setup">5. Setup & Configuration</h2>
    <h3>5.1 Prerequisites</h3>
    <ul>
        <li>PHP 8.x, Composer, MySQL 8.x</li>
        <li>Web server (Apache/Nginx). Ensure PHP file uploads are enabled.</li>
    </ul>
    <h3>5.2 Installation</h3>
    <ol>
        <li>Import <span class="code">auto_service_dbgg.sql</span> to MySQL and update <span class="code">config.php</span> credentials.</li>
        <li>Run <span class="code">composer install</span> to install PHPMailer/Sendinblue SDK.</li>
        <li>Set Brevo API key in <span class="code">API_config.php</span> or move secrets to environment variables.</li>
        <li>Ensure directories exist and are writable: <span class="code">uploads/</span>, <span class="code">profile_pics/</span>.</li>
    </ol>
    <h3>5.3 Environment</h3>
    <ul>
        <li>Recommended: use <span class="code">vlucas/phpdotenv</span> and <span class="code">.env</span> for DB and API keys.</li>
    </ul>

    <h2 id="security">6. Security & Compliance</h2>
    <ul>
        <li>Use CSRF tokens for all forms; rotate session IDs on login.</li>
        <li>Enable HttpOnly, Secure, SameSite cookies; add CSP and security headers.</li>
        <li>File upload hygiene: MIME validation, size limits, random names, non-executable storage.</li>
        <li>Wrap multi-step updates in DB transactions (quote accept, payments).</li>
        <li>Standardize status values and enforce via constraints or enums.</li>
        <li>Restrict access per role; centralize checks; audit via <span class="code">logs</span>.</li>
    </ul>

    <h2 id="ops">7. Operations & Maintenance</h2>
    <ul>
        <li>Backups: nightly DB dumps; periodic file backups of uploads.</li>
        <li>Monitoring: web server logs, PHP error logs, custom <span class="code">logs</span> table views.</li>
        <li>Updates: composer dependency updates quarterly; rotate API keys annually.</li>
    </ul>

    <h2 id="troubleshooting">8. Troubleshooting</h2>
    <table>
        <thead><tr><th>Symptom</th><th>Likely Cause</th><th>Fix</th></tr></thead>
        <tbody>
            <tr><td>Cannot send emails</td><td>Missing/invalid Brevo key</td><td>Set API key; verify sender domain</td></tr>
            <tr><td>Bookings allowed on blocked dates</td><td>Unavailable dates missing</td><td>Use Calendar Manager to toggle dates</td></tr>
            <tr><td>Cannot upload receipts</td><td>Permissions on uploads/</td><td>Ensure directory exists and is writable</td></tr>
        </tbody>
    </table>

    <h2 id="appendix">9. Appendix (Files & Endpoints)</h2>
    <h3>9.1 Key Pages</h3>
    <ul>
        <li><span class="code">index.php</span> – Marketing homepage; login-aware header</li>
        <li><span class="code">book.php</span> – Booking form (customer)</li>
        <li><span class="code">manage.php</span> – Appointment management (staff)</li>
        <li><span class="code">JOG.php</span> – Job order generation (staff)</li>
        <li><span class="code">QM.php</span> / <span class="code">admin_viewQM.php</span> – Quotation creation/overview</li>
        <li><span class="code">view.php</span> – Customer quotation view</li>
        <li><span class="code">Billing.php</span> / <span class="code">Billing_Cust.php</span> – Payments</li>
        <li><span class="code">manage_inventory.php</span> – Inventory CRUD</li>
        <li><span class="code">Calendar_manager.php</span> – Toggle unavailable dates</li>
        <li><span class="code">bay_manager.php</span> – Bay status and creation</li>
    </ul>

    <h3>9.2 Status Lifecycle (Summary)</h3>
    <ul>
        <li><strong>Appointment</strong>: pending → confirmed → in_progress → completed | declined | cancelled</li>
        <li><strong>Job Order</strong>: pending → completed</li>
        <li><strong>Quotation</strong>: pending → accepted → paid | declined</li>
        <li><strong>Payment</strong>: unverified → paid</li>
    </ul>

    <p class="small">Prepared for KCS Auto Service. Export: Open this HTML in Microsoft Word and save as .docx.</p>
</div>
</body>
</html>
